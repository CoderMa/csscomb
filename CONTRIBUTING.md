# For contributors

Текст от 20 сентября 2012.

## Содержание репозитория

**src/csscomb.php** — сама библиотека с алгоритмом сортировки + дефолтный список сортировки

**src/cli.php** — обвязка для CLI-версии

**src/plugins/** — исходный код плагинов. Там нет библиотеки CSScomb, которая копируется туда при построении проекта (см. построение проекта). Это не готовые к использованию плагины, это исходники.

**www/** — код [CSScomb.com](http://csscomb.com/). Оттуда, так же как и из плагинов, откушена библиотека CSScomb, чтобы избежать копипасты. Для работоспособности требуется построение проекта.

**build/** — готовые к использованию версии CSScomb (плагины, CLI). Содержимое в этой директории получается в результате построения проекта.

## Построение проекта                                                                                                                                  
Если вы совсем не знакомы с make, то вот всё, что вам нужно знать: make позволяет избавиться от copy-paste кода CSScomb + позволяет быстро и легко пропихивать изменения в CSScomb во все использующие его сущности: плагины, сайт и т.д.
                                             
Для построения проекта нужно иметь установленный make. На OS X 10.8, например, его нет по умолчанию, но он доступен в наборе [Command Line Tools](https://developer.apple.com/downloads/index.action).
                                                                                                                                                                                                                                                                             
Код ядра CSScomb находится в `src/csscomb.php`. Его нужно положить во все плагины, в CLI-версию и веб. Чтобы не делать это руками, я использую make.
                                                                                
После чекаута репозитория нужно выполнить в корне репозитория команду:
`make`

Автоматически соберутся:

* CLI-версия: `build/cli/`
* Плагины: `build/plugin/`
* Сайт: `www/`
  * обновится ядро CSScomb, 
  * причешутся, пожмутся и сконкатенируются CSS и JS файлы (при помощи YUI Compressor и самой CSScomb). Результат положится в _css/ и _js/ соответственно. Подробнее см. цель `buildWww` в Makefile.

## Как править ядро                                                                        
0. Если проблема связана с сортировкой, нужно выделить минимальный участок кода, на котором воспроизводится проблема. Пойти в [Issues](http://github.com/miripiruni/CSScomb/issues/) и посмотреть нет ли там открытого таска на эту тему. Или закрытого. Создать/переоткрыть таск. Желательно с англоязычным описанием, чтобы смысл был доступен всем.
1. Форкнуть проект.
2. Счекаутить.
3. Построить проект. Вам потребуется файл yuicompressor-2.4.7.jar из [YUICcompressor](http://yuilibrary.com/download/yuicompressor/). Он должен лежать в корне репозитория, на одном уровне с Makefile.
4. Добавить падающий тест в `www/tests/cases.php`.
5. Внести правки в `src/csscomb.php`.
6. Построить проект: выполнить команду `make` в корне репозитория. При этом все изменения в библиотеке попадут во все нужные места.
6. Убедится, что тесты, которые раньше проходились, не падают, и что свежий тест, из-за которого вся затея, тоже проходится успешно.
7. Закоммитить с упоминанием номера таска в комментарии к коммиту. Например: `'Fix issue #33: support LESS variables on test #test-id'`.
8. Отправить Pull request.

## Цикл разработки
В последнее время я выработал следующий цикл разработки:

* Все коммиты связываются с [Issue](https://github.com/miripiruni/CSScomb/issues?direction=desc&sort=created&state=open).
* Вся публичная деятельность только на английском.
* Новые версии планируются через [Milestones](https://github.com/miripiruni/CSScomb/issues/milestones?with_issues=yes). Каждая следующая формируется из набора наиболее актуальных открытых [Issue](https://github.com/miripiruni/CSScomb/issues?direction=desc&sort=created&state=open). Название Milestone содержит номер мажорной и минорной версии.
* При закрытии очередного Milestone создается tag в git.